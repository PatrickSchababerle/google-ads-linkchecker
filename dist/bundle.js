var urls=[],valid=[],errors=[];function getUniqueAdUrls(){Logger.log("   Getting all unique urls...");for(var e=AdsApp.ads().withCondition("Status = ENABLED").withCondition("CampaignStatus = ENABLED").withCondition("AdGroupStatus = ENABLED").get();e.hasNext();){var r=e.next();if("EXPANDED_DYNAMIC_SEARCH_AD"!=r.getType()){var t=r.urls().getFinalUrl();null!=t&&(config.stripParameters&&(t=t.split("?")[0]),-1==urls.indexOf(t)&&urls.push(t))}}Logger.log("   Got all unique urls ["+urls.length+"]...")}function sendErrorMail(e){var r=AdsApp.currentAccount(),t=r.getName(),n=r.getCustomerId(),i="<h1>Ungültige Zielseiten in "+t+" ["+n+"]</h1><p>Bei der Überprüfung des Accounts sind folgende Zielseiten als fehlerhaft erkannt worden:</p>";i+="<table><tr><td>URL</td><td>Response</td></tr>",e.forEach(function(e){i+="<tr><td>"+e[0]+"</td><td>"+e[1]+"</td></tr>"}),i+="</table>",config.stripParameters?i+="<p>Beachte, dass die Zieseiten ohne Parameter überprüft wurden - prüfe also zusätzlich, ob die Zielseiten auch mit Parametern nicht erreichbar sind.</p>":i+="<p>Die URLs wurden als Ganzes (inklusive Parameter) gecrawled.</p>",i+="<p>Liebe Grüße<br>Patrick</p>",MailApp.sendEmail(config.mail.recipient,"URL Checker: "+t+" ["+n+"]","",{htmlBody:i})}function getLength(e){e.length}getUniqueAdUrls(),urls.forEach(function(e,r){0==r?Logger.log("   ["+(r+1)+"/"+urls.length+"] Fetching "+e+"..."):Number.isInteger((r+1)/config.loggerSteps)&&Logger.log("   ["+(r+1)+"/"+urls.length+"] Fetching "+e+"...");var t=UrlFetchApp.fetch(e,{muteHttpExceptions:!0}).getResponseCode();t<=200||t>=400?errors.push([e,t]):valid.push([e,t])}),errors.length?sendErrorMail(errors):Logger.log("   CHECK OF "+getLength(valid)+" COMPLETED - No errors occured");